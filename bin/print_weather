#!/bin/bash
###############################################################################
#         Name: print_weather
#        Usage: ./print_weather
#
#  Description: Prints to STDOUT, the current weather and conditions
#               with unicode symbols, it uses Yahoo as source
#
# Last Updated: Thu 06 Nov 2014 03:05:55 PM CST
#
#       Author: Jose Elera (https://github.com/jelera)
#      License: MIT
#               Copyright (c) 2014 Jose Elera Campana
#               Permission is hereby granted, free of charge, to any person
#               obtaining a copy of this software and associated documentation
#               files (the "Software"), to deal in the Software without
#               restriction, including without limitation the rights to use,
#               copy, modify, merge, publish, distribute, sublicense, and/or
#               sell copies of the Software, and to permit persons to whom the
#               Software is furnished to do so, subject to the following
#               conditions:
#
#               The above copyright notice and this permission notice shall be
#               included in all copies or substantial portions of the Software.
#
#               THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
#               EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
#               OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
#               NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
#               HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
#               WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
#               FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
#               OTHER DEALINGS IN THE SOFTWARE.
###############################################################################


#----------------------------------------------------------------------------//
# => SETTINGS
#----------------------------------------------------------------------------//
WEATHER_LOCATION="USIL0225"  # Chicago, IL
WEATHER_DEG_UNIT="c"         # c for Celsius or f for Farenheit


#----------------------------------------------------------------------------//
# => MAIN SCRIPT
#----------------------------------------------------------------------------//
weather_text=`curl --silent "http://xml.weather.yahoo.com/forecastrss?p=$WEATHER_LOCATION&u=$WEATHER_DEG_UNIT" | grep -E '(Current Conditions:|C<BR)' | tail -n 1 | sed 's/\ C<BR\ \/>//'`
weather_condition=`echo ${weather_text} | awk -F , '{print tolower($1)}'`
w_hour=`date +%H`

case "$weather_condition" in
	"clear" | "fair" | "cold" | "sunny" | "hot")
		if [ "$w_hour" -lt 5 -o "$w_hour" -gt 18 ]; then
			condition_symbol="☾"
		else
			condition_symbol="☼"
		fi
		;;
	"rain" | "mixed rain and snow" | "mixed rain and sleet" | "freezing drizzle" | "drizzle" | "light drizzle" | "freezing rain" | "showers" | "mixed rain and hail" | "scattered showers" | "isolated thundershowers" | "thundershowers" | "light rain with thunder" | "light rain" | "rain and snow")
		condition_symbol="☔"
		;;
	"snow" | "mixed snow and sleet" | "snow flurries" | "light snow showers" | "blowing snow" | "sleet" | "hail" | "heavy snow" | "scattered snow showers" | "snow showers" | "light snow" | "snow/windy" | "snow grains" | "snow/fog")
		condition_symbol="☃"
		;;
	"cloudy" | "mostly cloudy" | "partly cloudy" | "partly cloudy/windy" | "cloudy/windy")
		condition_symbol="☁"
		;;
	"tornado" | "tropical storm" | "hurricane" | "severe thunderstorms" | "thunderstorms" | "isolated thunderstorms" | "scattered thunderstorms")
		condition_symbol="☔⚡"
		;;
	"dust" | "foggy" | "fog" | "haze" | "smoky" | "blustery" | "mist")
		condition_symbol="♨"
		;;
	"windy" | "fair/windy")
		condition_symbol="⚑"
		;;
	*)
		condition_symbol="?"
		;;
esac


#----------------------------------------------------------------------------//
# => RETURN STRING
#----------------------------------------------------------------------------//
echo "${condition_symbol} ${weather_text}ºC"
