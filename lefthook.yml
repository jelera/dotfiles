# Lefthook Configuration
# https://github.com/evilmartians/lefthook
#
# Git hooks for code quality and security checks
# Install: lefthook install
# Run manually: lefthook run pre-commit

# Run shellcheck on staged shell scripts
pre-commit:
  parallel: true
  commands:
    # Lint shell scripts
    shellcheck:
      glob: "*.sh"
      run: shellcheck {staged_files}
      skip:
        - merge
        - rebase

    # Lint shell scripts without .sh extension
    shellcheck-no-ext:
      glob: "{bin/*,shell/functions,shell/env}"
      run: shellcheck {staged_files}
      skip:
        - merge
        - rebase

    # Check for secrets/leaks in staged files
    gitleaks:
      run: gitleaks protect --verbose --redact --staged
      skip:
        - merge
        - rebase

    # Check for trailing whitespace
    trailing-whitespace:
      glob: "*.{sh,md,yml,yaml,toml,zsh}"
      run: |
        if grep -n '[[:space:]]$' {staged_files} 2>/dev/null; then
          echo "‚ùå Error: Trailing whitespace found"
          exit 1
        fi
      skip:
        - merge
        - rebase

# Full security scan before pushing
pre-push:
  parallel: true
  commands:
    # Full repository scan for secrets
    gitleaks-full:
      run: gitleaks detect --verbose --redact
      skip:
        - merge
        - rebase
